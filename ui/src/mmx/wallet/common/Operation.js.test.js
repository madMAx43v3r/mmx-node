import { assert, describe, expect, it } from "vitest";
import { Operation } from "./Operation";

import "../utils/Uint8ArrayUtils";

describe("mmx.operation.Deposit", () => {
    const json =
        '{"__type": "mmx.operation.Deposit", "version": 0, "address": "mmx1zmkneqqv28gyt8k8m3a09f2v2h3s0n44gly60hn5tq2d892re2asyh6g5x", "solution": 65535, "method": "trade", "args": ["mmx16aq5vpcmxcrh9xck0z06eqnmr87w5r2j062snjj6g7cvj0thry7q0mp3w6", "0x4189374bc6a7f0"], "user": null, "currency": "mmx1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqdgytev", "amount": "1000001"}';

    const hex =
        "ECB0047BCB0834C26669656C643C3E737472696E673C3E070000000000000076657273696F6E00000000000000006669656C643C3E737472696E673C3E07000000000000006164647265737362797465733C3E2000000000000000BBCA4395D3145874DEA7C947B5CE07E3554CA5F27ADCC79E45D0510C803CED166669656C643C3E737472696E673C3E06000000000000006D6574686F64737472696E673C3E050000000000000074726164656669656C643C3E737472696E673C3E040000000000000061726773766563746F723C3E0200000000000000737472696E673C3E3E000000000000006D6D7831366171357670636D786372683978636B307A303665716E6D723837773572326A303632736E6A6A36673763766A30746872793771306D70337736737472696E673C3E1000000000000000307834313839333734626336613766306669656C643C3E737472696E673C3E0400000000000000757365726F7074696F6E616C3C3E006669656C643C3E737472696E673C3E080000000000000063757272656E637962797465733C3E200000000000000000000000000000000000000000000000000000000000000000000000000000006669656C643C3E737472696E673C3E0600000000000000616D6F756E7441420F000000000000000000000000006669656C643C3E737472696E673C3E0800000000000000736F6C7574696F6EFFFF000000000000";

    it("hash_serialize", () => {
        const obj = JSON.parse(json);
        const op = new Operation(obj);
        const hash_serialize = op.hash_serialize(true);
        assert.equal(hash_serialize.toHex(), hex);
    });
});

describe("mmx.operation.Execute", () => {
    const json =
        '{"__type": "mmx.operation.Execute", "version": 0, "address": "mmx1zmkneqqv28gyt8k8m3a09f2v2h3s0n44gly60hn5tq2d892re2asyh6g5x", "solution": 0, "method": "withdraw", "args": [], "user": "mmx16aq5vpcmxcrh9xck0z06eqnmr87w5r2j062snjj6g7cvj0thry7q0mp3w6"}';

    const hex =
        "D1C198902D01D98C6669656C643C3E737472696E673C3E070000000000000076657273696F6E00000000000000006669656C643C3E737472696E673C3E07000000000000006164647265737362797465733C3E2000000000000000BBCA4395D3145874DEA7C947B5CE07E3554CA5F27ADCC79E45D0510C803CED166669656C643C3E737472696E673C3E06000000000000006D6574686F64737472696E673C3E080000000000000077697468647261776669656C643C3E737472696E673C3E040000000000000061726773766563746F723C3E00000000000000006669656C643C3E737472696E673C3E0400000000000000757365726F7074696F6E616C3C3E0162797465733C3E20000000000000003C19773DC9B0475ACA09957E520DEAFC197B82AC9F78169B7207361B074641D76669656C643C3E737472696E673C3E0800000000000000736F6C7574696F6E0000000000000000";

    it("hash_serialize", () => {
        const obj = JSON.parse(json);
        const op = new Operation(obj);
        const hash_serialize = op.hash_serialize(true);
        assert.equal(hash_serialize.toHex(), hex);
    });
});

describe("mmx.operation.Operation", () => {
    it("invalid type", () => {
        expect(() => new Operation(Symbol("invalid type"))).toThrowError();
    });
});
